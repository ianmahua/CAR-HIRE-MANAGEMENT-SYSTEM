# Database Reseed Script

## Overview

The `reseedDatabase.js` script clears and repopulates your database with fresh, realistic test data for comprehensive system testing.

## Usage

### Running the Script

```bash
npm run reseed
```

Or directly:

```bash
node backend/seeds/reseedDatabase.js
```

### What It Does

The script will:

1. **Prompt for Confirmation** - Asks before clearing any data
2. **Clear Existing Data** - Safely removes all data except `admin@ressytours.com`
3. **Create Fresh Test Data** - Generates realistic Kenyan test data with proper relationships

## Data Created

### Users (8 total)
- **1 Main Admin**: admin@ressytours.com / admin123
- **4 Drivers**: Including Dan Wesa (dan@ressytours.com / driver123), James Kimani, Mary Njeri, Peter Ochieng
- **2 Additional Admins**: password123
- **1 Director**: password123

### Customers (40 total)
- Realistic Kenyan names (John Mwangi, Sarah Wanjiru, etc.)
- Phone format: 254XXXXXXXXX (valid Kenyan mobile numbers)
- Emails: firstname.lastname@gmail.com
- 8-digit ID numbers
- 15 returning clients with loyalty points

### Vehicles (25 total)
- **12 Available** (Parking status)
- **10 Currently Rented** (Rented Out status)
- **3 In Service** (In Garage status)
- Makes: Toyota (8), Nissan (5), Isuzu (4), Mazda (3), Mitsubishi (3), Honda (2)
- Kenyan license plates (KCT 890T, KCS 567S, etc.)
- Daily rates: 3000-8000 KES
- Each vehicle includes 2-4 service log entries
- Maintenance tracking with mileage and service dates
- Some vehicles near service threshold (for alert testing)

### Rentals (50 total)
- **10 Active** (currently ongoing)
- **5 Due TODAY** (for Returns Today testing)
- **3 Due TOMORROW** (for Vehicles Due testing)
- **30 Completed** (returned in past 6 months)
- **2 Overdue** (past return date, still active)
- Proper relationships to customers, vehicles, and drivers
- 2-3 rentals with extensions
- Destinations: Mombasa, Kisumu, Nakuru, Eldoret, etc.

### Bookings (30 total)
- **6 for TODAY** (testing confirmation flow)
- **4 for TOMORROW** (reminder testing)
- **12 Future** (next 30 days)
- **8 Past** (4 completed, 4 cancelled)
- Vehicle requests (make/model text, not actual vehicles)
- Various statuses: pending, confirmed, cancelled, completed

### Transactions (80 total)
- Linked to rentals
- **Deposits** (~50 transactions, 50% of rental total)
- **Balance Payments** (~27 transactions, remaining 50%)
- **Extension Payments** (~3 transactions for extended rentals)
- Payment methods: Cash (40%), M-Pesa (50%), Bank Transfer (10%)
- All properly linked to rental references

### Service Records
- Embedded in Vehicle.service_log array (2-4 per vehicle)
- Service types: Maintenance, Repair, Inspection
- Service providers: ABC Motors, Quick Fix Garage, Toyota Service Center, Ressey Workshop
- Costs: 5000-25000 KES
- Spread over past year
- Maintenance fields calculated from service history

## Special Test Scenarios

The script includes specific scenarios for thorough testing:

1. âœ… **Frequent Customer**: One customer with 5+ rental history (for returning client testing)
2. âœ… **Complete Service History**: All vehicles have 2-4 service records
3. âœ… **Overdue Alerts**: 2 rentals past due date (for overdue alerts)
4. âœ… **Today's Returns**: 5 rentals due back today (Returns Today testing)
5. âœ… **Tomorrow's Returns**: 3 rentals due tomorrow (Vehicles Due testing)
6. âœ… **Today's Bookings**: 6 bookings scheduled for today (confirmation flow)
7. âœ… **Service Alerts**: Vehicles with current mileage near service threshold
8. âœ… **Extended Rentals**: 2-3 rentals with extension payments

## Login Credentials

### Main Admin
- **Email**: admin@ressytours.com
- **Password**: admin123

### Driver (Dan Wesa)
- **Email**: dan@ressytours.com
- **Password**: driver123

### All Other Users
- **Password**: password123

## Data Relationships

The script ensures proper relationships:

- âœ… Rentals â†’ Valid customers, vehicles, drivers
- âœ… Transactions â†’ Valid rentals with correct amounts
- âœ… Service logs â†’ Embedded in vehicles with proper dates/mileage
- âœ… Active rentals â†’ Vehicles marked as "Rented Out"
- âœ… Completed rentals â†’ Vehicles marked as "Parking"
- âœ… Customer hire history â†’ Updated with rental records

## Important Notes

1. **Confirmation Required**: The script asks for confirmation before clearing data
2. **Admin Preserved**: The main admin account (admin@ressytours.com) is preserved if it exists
3. **Error Handling**: Gracefully handles errors with detailed stack traces
4. **Progress Logging**: Shows progress for each step
5. **Summary Report**: Prints comprehensive summary at completion

## Notifications

Notifications are **NOT** seeded directly. They are auto-generated by the system based on:
- Rentals due today/tomorrow
- Bookings scheduled for today/tomorrow
- Vehicles near service threshold
- Overdue rentals

This ensures the notification system is properly tested in real-time.

## Troubleshooting

### MongoDB Connection Issues
- Ensure MongoDB is running
- Check your `.env` file has correct `MONGODB_URI`
- Default: `mongodb://localhost:27017/ressey-tours-crms`

### Script Fails to Run
- Make sure you're in the project root directory
- Ensure all dependencies are installed: `npm install`
- Check Node.js version (minimum v14 recommended)

### Data Not Showing Up
- Verify the script completed without errors
- Check the summary report for record counts
- Refresh your browser/application
- Clear browser cache if needed

## Development

To modify the seed data:
1. Edit `backend/seeds/reseedDatabase.js`
2. Adjust data arrays (kenyanNames, vehicleData, etc.)
3. Modify quantities in the creation loops
4. Run `npm run reseed` to test changes

---

**Happy Testing! ðŸŽ‰**


